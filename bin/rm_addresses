#!/bin/bash

path=$(type -p $0)
path=${path%/*}

. $path/init
. $bindir/loglib

trap logfinish 0

log $prog

realy=1

cd $ntdir || { log fatal: no ntdir, exiting ; exit 1 ; }

maxage=43200  # 12*3600
now=$(date +%s)
for addr in *
do
  [ -d $addr ] || { log no $addr ; continue ; }
  [ -f $addr/blocked ] && continue
  latest=0
  for file in $addr/*
  do
    stamp=$(stat --printf=%Y $file)
    [ $stamp -gt $latest ] && { latest=$stamp ; log $file $latest ; }
  done
  age=$(( $now - $latest ))
  log $age
  if [ $age -gt $maxage ]
  then
    log rm $addr
    if [ $realy = 1 ]
    then
      rm -r $addr
    else
      log would rm $addr
    fi
  fi
done
