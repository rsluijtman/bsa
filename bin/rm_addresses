#!/bin/bash

path=$(type -p $0)
path=${path%/*}

. $path/init
. $bindir/loglib

trap logfinish 0

log $prog

realy=1

cd $ntdir || { log no ntdir, exiting ; exit 1 ; }

maxage=7200
latest=0
now=$(date +%s)
for addr in *
do
  [ -d $addr ] || { log no $addr ; continue ; }
  for file in $addr/*
  do
    stamp=$(stat --printf=%Y $file)
    log $(printf "%-16s   %s\n" $file  "$(date -d @$stamp)")
    [ $stamp -gt $latest ] && latest=$stamp
  done
  age=$(( $now - $latest ))
  if [ $age -gt $maxage ]
  then
    log rm $addr
    if [ $realy = 1 ]
    then
      rm -r $addr
    else
      log would rm $addr
    fi
  fi
done
