#!/bin/bash

 lock=/tmp/cron-bsa-running

rmlock(){
 echo removing lock
 if [ -f $lock ]
 then
  rm $lock
  res=$?
  echo  result of rm: $res
 else
  echo no lock 
 fi
}

if [ ! -t 0 ]
then
 exec >> /tmp/bsa-cron.log
 exec 2>&1
 echo '======================'
 date
fi

path=$(type -p $0)
path=${path%/*}

if [ -z "$path" -o ! -d "$path" ]
then
  echo could not find working dir
  exit 1
fi

. $path/init

if [ -f $lock ]
then
  echo already running
  exit 0
fi
touch $lock
 
trap rmlock 0

. $bindir/checkfw

. $bindir/action

#trap -p 0 2>&1
#rmlock
