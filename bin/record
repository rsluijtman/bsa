[ -n "$_record_" ] && return
_record_=1

record_noted_event(){
  address=$1
  sshpid=$2
  [ -d $dbdir/noted/$address ] || mkdir -p $dbdir/noted/$address
  touch $dbdir/noted/$address/$sshpid
  log recording $address $sshpid
}

record_noted_ip(){
  address=$1
  [ -d $dbdir/noted/$address ] || mkdir -p $dbdir/noted/$address

  while :
  do
    record=$dbdir/noted/$address/r$RANDOM
    [ -f $record ] && continue
    touch $record && break
  done

  log recording $address
}

record_block(){
  address=$1
  [ -d "$blkdir" ] || { echo no blkdir ; exit 1 ; }
  touch $blkdir/$address
  log recording block $address
}

remove_record(){
  address=$1
  [ -z "$address" ] && { log empty address ; exit 1 ; }
  [ -d "$ntdir/$address" ] || { log no ntdir/address ; exit 1 ; }
  rm -r $ntdir/$address || log "rm $address failed"
  log rm $ntdir/$address
}

